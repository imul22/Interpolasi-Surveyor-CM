<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Model Tabel</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">

<div class="container py-5">
    <div class="row justify-content-center">
        <div class="col-md-8">
            <a href="/" class="btn btn-link mb-3 text-decoration-none p-0">‚Üê Kembali ke Menu</a>
            <div class="card shadow-sm">
                <div class="card-header bg-success text-white">
                    <h4 class="mb-0">üìä Interpolasi Tabel Trim Correction</h4>
                </div>
                <div class="card-body">
                    <p class="text-muted small">Mencari Hasil Correction Trim Pada Tabel</p>
                    <table class="table table-bordered align-middle" id="tabelData">
                        <thead class="table-light">
                            <tr>
                                <th width="45%">X (Input)</th>
                                <th width="45%">Y (Output)</th>
                                <th width="10%"></th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><input type="number" class="form-control ix" value="0"></td>
                                <td><input type="number" class="form-control iy" value="0"></td>
                                <td></td>
                            </tr>
                            <tr>
                                <td><input type="number" class="form-control ix" value="10"></td>
                                <td><input type="number" class="form-control iy" value="100"></td>
                                <td></td>
                            </tr>
                        </tbody>
                    </table>
                    <button onclick="tambahBaris()" class="btn btn-outline-secondary btn-sm mb-4">+ Tambah Baris</button>
                    
                    <div class="row g-3 align-items-end">
                        <div class="col-md-8">
                            <label class="form-label fw-bold">Masukkan X untuk mencari Y:</label>
                            <input type="number" id="cariX" class="form-control form-control-lg" placeholder="Contoh: 5">
                        </div>
                        <div class="col-md-4">
                            <button onclick="prosesTabel()" class="btn btn-success btn-lg w-100">Proses</button>
                        </div>
                    </div>

                    <div id="resultBox" class="mt-4 p-4 border rounded text-center d-none" style="background-color: #f0fff4;">
                        <h4 id="hasilTabel" class="text-success mb-0"></h4>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    async function prosesTabel() {
        const xTarget = parseFloat(document.getElementById('cariX').value);
        const xElements = document.querySelectorAll('.ix');
        const yElements = document.querySelectorAll('.iy');
        
        // Susun data tabel menjadi Array of Objects
        const dataTabel = [];
        xElements.forEach((el, i) => {
            dataTabel.push({ x: parseFloat(el.value), y: parseFloat(yElements[i].value) });
        });

        // Kirim ke server
        const response = await fetch('/api/hitung-tabel', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ xTarget, data: dataTabel })
        });

        const result = await response.json();

        if (result.error) {
            alert(result.error);
        } else {
            document.getElementById('resultBox').classList.remove('d-none');
            document.getElementById('hasilTabel').innerText = `Hasil: Y = ${result.hasil} (di ${result.range})`;
        }
    }
</script>
</body>
</html>